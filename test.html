<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Attendance Form</title>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
</head>
<body>
  <h2>Student Attendance Form</h2>
  
  <div>
    <label for="program">Program/Event Name:</label>
    <input type="text" id="program">
  </div>
  <br>
  
  <div>
    <label for="name">Student Name:</label>
    <input type="text" id="name">
  </div>
  <br>
  
  <div>
    <label for="rollNo">Roll No:</label>
    <input type="text" id="rollNo">
  </div>
  <br>
  
  <div>
    <label for="srNo">SR No:</label>
    <input type="text" id="srNo">
  </div>
  <br>
  
  <div>
    <label for="semester">Semester:</label>
    <input type="text" id="semester">
  </div>
  <br>
  
  <div>
    <label for="branch">Branch:</label>
    <input type="text" id="branch">
  </div>
  <br>
  
  <div>
    <label for="batch">Batch:</label>
    <input type="text" id="batch">
  </div>
  <br>
  
  <div>
    <label for="faculty">Issuing Faculty Name:</label>
    <input type="text" id="faculty">
  </div>
  <br>
  
  <button id="fillBtn" onclick="fillAndPreviewPdf()">Fill & Preview PDF</button>

  <script>
    // Generate the PDF with filled form data and preview it in a new tab
    async function fillAndPreviewPdf() {
      try {
        const existingPdfBytes = await fetchPdfAsBytes('DutyLeaveForm.pdf');

        const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
        const pages = pdfDoc.getPages();
        const firstPage = pages[0];

        const font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);
        const { width, height } = firstPage.getSize();

        // Get form values
        const program = document.getElementById('program').value;
        const studentName = document.getElementById('name').value;
        const rollNo = document.getElementById('rollNo').value;
        const srNo = document.getElementById('srNo').value;
        const semester = document.getElementById('semester').value;
        const branch = document.getElementById('branch').value;
        const batch = document.getElementById('batch').value;
        const faculty = document.getElementById('faculty').value;
        
        // Fill the program field
        firstPage.drawText(program, {
          x: 80,
          y: height - 107,
          size: 14,
          font: font,
        });
        
        // Fill student name
        firstPage.drawText(studentName, {
          x: 88,
          y: height - 137,
          size: 14,
          font: font,
        });
        
        // Fill roll number
        firstPage.drawText(rollNo, {
          x: 339,
          y: height - 137,
          size: 14,
          font: font,
        });
        
        // Fill SR number
        firstPage.drawText(srNo, {
          x: 454,
          y: height - 137,
          size: 14,
          font: font,
        });
        
        // Fill semester
        firstPage.drawText(semester, {
          x: 100,
          y: height - 160,
          size: 14,
          font: font,
        });
        
        // Fill branch
        firstPage.drawText(branch, {
          x: 230,
          y: height - 160,
          size: 14,
          font: font,
        });
        
        // Fill batch
        firstPage.drawText(batch, {
          x: 330,
          y: height - 160,
          size: 14,
          font: font,
        });
        
        

        // Save the filled PDF and preview it in a new tab
        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        window.open(url, '_blank');
      } catch (error) {
        console.error('Error generating PDF:', error);
        alert('Error generating PDF. Please check console for details.');
      }
    }

    async function fetchPdfAsBytes(url) {
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return await response.arrayBuffer();
      } catch (error) {
        console.error('Error fetching PDF:', error);
        alert('Could not fetch the PDF form. Please ensure the form is available at the correct path.');
        throw error;
      }
    }
  </script>
</body>
</html>